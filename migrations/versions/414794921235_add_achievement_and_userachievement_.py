"""Add Achievement and UserAchievement models

Revision ID: 414794921235
Revises: 5d18f0a4938e
Create Date: 2025-05-09 11:41:22.538499

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '414794921235' # ã‚ãªãŸã®ç’°å¢ƒã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿéš›ã®IDã«ç½®ãæ›ãˆã¦ãã ã•ã„
down_revision = '5d18f0a4938e' # ã“ã‚Œã¯æ­£ã—ã„ã¯ãšã§ã™
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('achievement_definitions',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=100), nullable=False),
    sa.Column('name', sa.String(length=150), nullable=False),
    sa.Column('description', sa.Text(), nullable=False),
    sa.Column('icon_class', sa.String(length=100), nullable=True),
    sa.Column('category_code', sa.String(length=50), nullable=False),
    sa.Column('category_name', sa.String(length=100), nullable=False),
    sa.Column('share_text_template', sa.Text(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('achievement_definitions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_achievement_definitions_category_code'), ['category_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_achievement_definitions_code'), ['code'], unique=True)

    op.create_table('user_achievements',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('achievement_code', sa.String(length=100), nullable=False),
    sa.Column('unlocked_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['achievement_code'], ['achievement_definitions.code'], name=op.f('fk_user_achievements_achievement_code_achievement_definitions'), ondelete='CASCADE'), # nameã‚’è¿½åŠ 
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('fk_user_achievements_user_id_users'), ondelete='CASCADE'), # nameã‚’è¿½åŠ 
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'achievement_code', name='uq_user_achievement')
    )
    with op.batch_alter_table('user_achievements', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_achievements_achievement_code'), ['achievement_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_achievements_user_id'), ['user_id'], unique=False)

    # ### end Alembic commands ###

    # â–¼â–¼â–¼ åˆæœŸå®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥å‡¦ç†ã‚’ã“ã“ã‹ã‚‰è¿½åŠ  â–¼â–¼â–¼
    achievement_definitions_table = sa.table(
        'achievement_definitions',
        sa.column('code', sa.String),
        sa.column('name', sa.String),
        sa.column('description', sa.Text),
        sa.column('icon_class', sa.String),
        sa.column('category_code', sa.String),
        sa.column('category_name', sa.String),
        sa.column('share_text_template', sa.Text)
    )

    op.bulk_insert(achievement_definitions_table, [
        {
            'code': 'FIRST_VEHICLE', 'name': 'æœ€åˆã®ç›¸æ£’', 'description': 'åˆã‚ã¦è»Šä¸¡ã‚’ç™»éŒ²ã™ã‚‹',
            'icon_class': 'fas fa-car-side', 'category_code': 'vehicle', 'category_name': 'è»Šä¸¡é–¢é€£',
            'share_text_template': 'å®Ÿç¸¾ã€Œ{achievement_name}ã€ã‚’è§£é™¤ï¼åˆã‚ã¦ã®æ„›è»Šã‚’ç™»éŒ²ã—ãŸã‚ˆï¼ğŸï¸ #ã‚‚ã¨ã·ã£ã·ãƒ¼'
        },
        {
            'code': 'FIRST_FUEL_LOG', 'name': 'çµ¦æ²¹ãƒ‡ãƒ“ãƒ¥ãƒ¼', 'description': 'åˆã‚ã¦çµ¦æ²¹è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹',
            'icon_class': 'fas fa-gas-pump', 'category_code': 'fuel', 'category_name': 'çµ¦æ²¹è¨˜éŒ²',
            'share_text_template': 'å®Ÿç¸¾ã€Œ{achievement_name}ã€ã‚’è§£é™¤ï¼åˆã‚ã¦çµ¦æ²¹ã‚’è¨˜éŒ²ï¼â›½ #ã‚‚ã¨ã·ã£ã·ãƒ¼'
        },
        {
            'code': 'FIRST_MAINT_LOG', 'name': 'åˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹', 'description': 'åˆã‚ã¦æ•´å‚™è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹',
            'icon_class': 'fas fa-tools', 'category_code': 'maintenance', 'category_name': 'æ•´å‚™è¨˜éŒ²',
            'share_text_template': 'å®Ÿç¸¾ã€Œ{achievement_name}ã€ã‚’è§£é™¤ï¼åˆã‚ã¦æ•´å‚™ã‚’è¨˜éŒ²ï¼ğŸ”§ #ã‚‚ã¨ã·ã£ã·ãƒ¼'
        },
        {
            'code': 'FIRST_NOTE', 'name': 'åˆã‚ã¦ã®ãƒ¡ãƒ¢', 'description': 'åˆã‚ã¦ãƒãƒ¼ãƒˆã¾ãŸã¯ã‚¿ã‚¹ã‚¯ã‚’è¨˜éŒ²ã™ã‚‹',
            'icon_class': 'fas fa-book', 'category_code': 'general', 'category_name': 'ãã®ä»–',
            'share_text_template': 'å®Ÿç¸¾ã€Œ{achievement_name}ã€ã‚’è§£é™¤ï¼æ€ã„å‡ºã‚„ã‚¿ã‚¹ã‚¯ã‚’æ®‹ã—ãŸã‚ˆï¼ğŸ“ #ã‚‚ã¨ã·ã£ã·ãƒ¼'
        },
        {
            'code': 'FIRST_ODO_RESET', 'name': 'ODOãƒªã‚»ãƒƒãƒˆåˆä½“é¨“', 'description': 'åˆã‚ã¦ODOãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ãƒªã‚»ãƒƒãƒˆã‚’è¨˜éŒ²ã™ã‚‹',
            'icon_class': 'fas fa-undo', 'category_code': 'vehicle', 'category_name': 'è»Šä¸¡é–¢é€£',
            'share_text_template': 'å®Ÿç¸¾ã€Œ{achievement_name}ã€ã‚’è§£é™¤ï¼ãƒ¡ãƒ¼ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆã‚’ä½“é¨“ï¼ğŸ”„ #ã‚‚ã¨ã·ã£ã·ãƒ¼'
        }
    ])
    # â–²â–²â–² åˆæœŸå®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥å‡¦ç†ã“ã“ã¾ã§ â–²â–²â–²


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('user_achievements', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_achievements_user_id'))
        batch_op.drop_index(batch_op.f('ix_user_achievements_achievement_code'))
        # ForeignKeyConstraint ã®åå‰ã‚’æŒ‡å®šã—ã¦å‰Šé™¤ (op.f() ã§ç”Ÿæˆã•ã‚ŒãŸåå‰ã‚’ä½¿ã†)
        batch_op.drop_constraint(batch_op.f('fk_user_achievements_user_id_users'), type_='foreignkey')
        batch_op.drop_constraint(batch_op.f('fk_user_achievements_achievement_code_achievement_definitions'), type_='foreignkey')


    op.drop_table('user_achievements')
    with op.batch_alter_table('achievement_definitions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_achievement_definitions_code'))
        batch_op.drop_index(batch_op.f('ix_achievement_definitions_category_code'))

    op.drop_table('achievement_definitions')
    # ### end Alembic commands ###
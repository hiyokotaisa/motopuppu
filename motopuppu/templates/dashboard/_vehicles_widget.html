{# motopuppu/templates/dashboard/_vehicles_widget.html #}
<div class="accordion-item card mb-4" data-widget-name="vehicles">
    <h2 class="accordion-header" id="heading-vehicles">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-vehicles" aria-expanded="true" aria-controls="collapse-vehicles">
            <span class="widget-grab-handle me-2" title="ドラッグして並び替え"><i class="fas fa-grip-vertical"></i></span>
            <span class="me-auto"><i class="fas fa-motorcycle me-1"></i> <strong>登録車両</strong></span>
        </button>
    </h2>
    <div id="collapse-vehicles" class="accordion-collapse collapse show" aria-labelledby="heading-vehicles">
        <div class="card-body">
            {% if motorcycles %}
                <ul class="list-group list-group-flush">
                    {% for motorcycle_item in motorcycles %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span class="d-flex align-items-center">
                            {# ▼▼▼【ここから変更】アイコン画像表示を追加 ▼▼▼ #}
                            {% if motorcycle_item.image_url %}
                                <img src="{{ motorcycle_item.image_url }}" alt="{{ motorcycle_item.name }}" class="vehicle-icon-image me-3">
                            {% endif %}
                            <div>
                                {% if motorcycle_item.is_default %}<i class="fas fa-star text-warning me-1" title="デフォルト車両"></i>{% endif %}
                                <strong>{{ motorcycle_item.name }}</strong>
                                {% if motorcycle_item.is_racer %}<span class="badge bg-info ms-1">レーサー</span>{% else %}<span class="badge bg-secondary ms-1">公道車</span>{% endif %}
                                <small class="text-muted">({{ motorcycle_item.maker or 'メーカー不明' }} / {{ motorcycle_item.year or '年式不明' }})</small>
                                <br>
                                
                                {# ▼▼▼【ここから変更】車両タイプごとの情報表示を if/else に変更 ▼▼▼ #}
                                {% if motorcycle_item.is_racer %}
                                    <small class="text-info"><i class="fas fa-stopwatch me-1"></i> 総稼働: <strong>{{ "%.2f"|format(motorcycle_item.total_operating_hours if motorcycle_item.total_operating_hours is not none else 0) }}</strong> 時間</small>
                                {% else %}
                                    {% set log_info = latest_log_info.get(motorcycle_item.id) %}
                                    {% if log_info %}
                                        {# ▼▼▼【ここから変更】クラスを text-info から text-muted に変更し、日付部分のspanを統合 ▼▼▼ #}
                                        <small class="text-muted"><i class="fas fa-road me-1"></i> 最新ODO: <strong>{{ log_info.odo | int }}</strong> km ({{ log_info.date.strftime('%Y-%m-%d') }})</small>
                                        {# ▲▲▲【変更はここまで】▲▲▲ #}
                                    {% else %}
                                        <small class="text-muted">走行記録がありません</small>
                                    {% endif %}
                                {% endif %}
                                {# ▲▲▲【変更はここまで】▲▲▲ #}
                            </div>
                            {# ▲▲▲【変更はここまで】▲▲▲ #}
                        </span>
                        <div class="btn-group btn-group-sm">
                            <a href="{{ url_for('activity.list_activities', vehicle_id=motorcycle_item.id) }}" class="btn btn-outline-info" title="この車両の活動ログを閲覧"><i class="fas fa-flag-checkered"></i></a>
                            {% if not motorcycle_item.is_racer %}<a href="{{ url_for('fuel.add_fuel', motorcycle_id=motorcycle_item.id) }}" class="btn btn-outline-success" title="この車両の給油記録を追加"><i class="fas fa-gas-pump"></i></a><a href="{{ url_for('maintenance.add_maintenance', motorcycle_id=motorcycle_item.id) }}" class="btn btn-outline-warning" title="この車両の整備記録を追加"><i class="fas fa-tools"></i></a>{% else %}<span class="btn btn-outline-success disabled" title="レーサー車両は給油記録の対象外です"><i class="fas fa-gas-pump"></i></span><span class="btn btn-outline-warning disabled" title="レーサー車両の整備記録は現在対応していません"><i class="fas fa-tools"></i></span>{% endif %}
                            <a href="{{ url_for('vehicle.edit_vehicle', vehicle_id=motorcycle_item.id) }}" class="btn btn-outline-secondary" title="車両情報を編集"><i class="fas fa-edit"></i></a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}<p class="card-text text-muted">車両が登録されていません。</p>{% endif %}
            <div class="mt-3"><a href="{{ url_for('vehicle.add_vehicle') }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-plus me-1"></i> 車両を追加</a></div>
        </div>
    </div>
</div>
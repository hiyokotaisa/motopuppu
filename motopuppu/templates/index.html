{# motopuppu/templates/index.html #}
{% extends "base.html" %}

{% block title %}ã‚‚ã¨ã·ã£ã·ãƒ¼ã¸ã‚ˆã†ã“ã - ãƒ­ã‚°ã‚¤ãƒ³{% endblock %}

{% block page_specific_head %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@1,800&family=Poppins:wght@400;500;600;700&display=swap"
    rel="stylesheet">
{% endblock %}

{% block content %}
<style>
    /* --- Hero Section --- */
    .hero-section {
        /* Deep Blue / Night Ride Theme */
        background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        color: white;
        padding: 5rem 0 7rem;
        margin-bottom: -3rem;
        border-radius: 0 0 50% 50% / 3rem;
        position: relative;
        overflow: hidden;
    }

    /* Asphalt/Carbon Texture Overlay */
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image:
            radial-gradient(#ffffff 15%, transparent 16%),
            radial-gradient(#ffffff 15%, transparent 16%);
        background-size: 60px 60px;
        background-position: 0 0, 30px 30px;
        opacity: 0.03;
    }

    /* Speed Lines / Dynamic Accent */
    .hero-section::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: repeating-linear-gradient(45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.03) 10px,
                rgba(255, 255, 255, 0.03) 20px);
        pointer-events: none;
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    /* --- App Title Styling --- */
    .app-title {
        font-family: 'Kanit', sans-serif;
        font-weight: 800;
        font-style: italic;
        letter-spacing: -0.02em;
        text-transform: uppercase;
        text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.3);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #ffffff !important;
        -webkit-text-fill-color: initial;
        /* Ensure no gradient fill persists */
    }

    .app-icon-wrapper {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);
        border-radius: 20px;
        transform: skew(-10deg);
        margin-right: 1rem;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .app-icon-wrapper i {
        transform: skew(10deg);
        /* Counter-skew icon */
        font-size: 2.5rem;
        color: white;
        -webkit-text-fill-color: white;
        /* Override gradient text fill */
    }

    /* --- Feature Cards (Gradient) --- */
    .feature-card {
        border: none;
        border-radius: 1rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
        height: 100%;
    }

    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, .175) !important;
    }

    .feature-icon-wrapper {
        width: 64px;
        height: 64px;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin-bottom: 1.5rem;
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }

    /* --- Timeline Section --- */
    .step-timeline {
        position: relative;
        padding-left: 2rem;
    }

    .step-timeline::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 15px;
        width: 3px;
        background: #e9ecef;
    }

    .step-item {
        position: relative;
        padding-bottom: 3rem;
        padding-left: 2rem;
    }

    .step-item:last-child {
        padding-bottom: 0;
    }

    .step-marker {
        position: absolute;
        left: 0;
        top: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #fff;
        border: 4px solid #0d6efd;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #0d6efd;
    }

    /* --- Login Card Floating --- */
    .login-card-wrapper {
        margin-top: -4rem;
        position: relative;
        z-index: 10;
    }
</style>

{# --- Hero Section --- #}
<div class="hero-section text-center">
    <div class="container hero-content">
        <div class="mb-4 d-flex justify-content-center align-items-center">
            <div class="app-icon-wrapper">
                <i class="fas fa-motorcycle"></i>
            </div>
            <h1 class="display-2 mb-0 app-title">
                ã‚‚ã¨ã·ã£ã·ãƒ¼
            </h1>
        </div>
        <p class="fs-4 fw-light mb-4 text-light opacity-75" style="letter-spacing: 1px;">Bike Life, All in One Place</p>
        <p class="lead mb-5 text-light opacity-75">
            æ„›è»Šã®è¨˜éŒ²ã‚’ã€ã‚‚ã£ã¨æ‰‹è»½ã«ã€ã‚‚ã£ã¨æ¥½ã—ãã€‚<br>
            çµ¦æ²¹ã‹ã‚‰ã‚µãƒ¼ã‚­ãƒƒãƒˆèµ°è¡Œã¾ã§ã€ã‚ãªãŸã®ãƒã‚¤ã‚¯ãƒ©ã‚¤ãƒ•ã‚’ãƒˆãƒ¼ã‚¿ãƒ«ã‚µãƒãƒ¼ãƒˆã€‚
        </p>
        <div class="d-flex justify-content-center gap-3">
            <a href="#login-area" class="btn btn-light btn-lg px-4 fw-bold text-primary shadow-sm">
                <i class="fas fa-sign-in-alt me-2"></i>ä»Šã™ãå§‹ã‚ã‚‹
            </a>
            <a href="#features-area" class="btn btn-outline-light btn-lg px-4">
                æ©Ÿèƒ½ã‚’è¦‹ã‚‹
            </a>
        </div>
    </div>
</div>

<div class="container mb-5">
    {# --- Login Card (Floating) --- #}
    <div class="row justify-content-center login-card-wrapper" id="login-area">
        <div class="col-md-8 col-lg-6">
            <div class="card border-0 shadow-lg rounded-3">
                <div class="card-body p-4 p-md-5 text-center">
                    <h3 class="card-title fw-bold mb-3">Misskey ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³</h3>
                    <p class="text-muted mb-4">
                        é¢å€’ãªç™»éŒ²ã¯ä¸è¦ã§ã™ã€‚<br>ãŠä½¿ã„ã®Misskeyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã™ãã«å§‹ã‚ã‚‰ã‚Œã¾ã™ã€‚
                    </p>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show text-start"
                        role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}

                    <a href="{{ url_for('auth.login') }}"
                        class="btn btn-primary btn-lg w-100 mb-3 py-3 fw-bold shadow-sm" id="login-button">
                        <i class="fas fa-key me-2"></i>Misskeyã§ãƒ­ã‚°ã‚¤ãƒ³
                    </a>

                    <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="checkbox" value="" id="remember-me" checked>
                            <label class="form-check-label small text-muted" for="remember-me">
                                ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã¾ã¾ã«ã™ã‚‹
                            </label>
                        </div>
                    </div>

                    <p class="small text-muted mb-0">ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: {{ config.MISSKEY_INSTANCE_URL }}</p>
                </div>
            </div>
        </div>
    </div>

    {# --- Features Section --- #}
    <div class="py-5" id="features-area">
        <div class="text-center mb-5">
            <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2 mb-2">FEATURES</span>
            <h2 class="fw-bold">ã‚‚ã¨ã·ã£ã·ãƒ¼ã§ã§ãã‚‹ã“ã¨</h2>
            <p class="text-muted">ãƒã‚¤ã‚¯ãƒ©ã‚¤ãƒ•ã‚’å……å®Ÿã•ã›ã‚‹ãŸã‚ã®æ©Ÿèƒ½ãŒæº€è¼‰ã§ã™ã€‚</p>
        </div>

        <div class="row g-4">
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card shadow-sm h-100 bg-primary text-white"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="card-body p-4">
                        <div class="feature-icon-wrapper">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                        <h5 class="fw-bold mb-3">çµ¦æ²¹è¨˜éŒ² & ç‡ƒè²»åˆ†æ</h5>
                        <p class="opacity-75 mb-0">
                            æ—¥ã€…ã®çµ¦æ²¹ã‚’è¨˜éŒ²ã—ã¦ã€ç‡ƒè²»ã®æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•ã§ç¢ºèªã€‚ã‚³ã‚¹ãƒˆç®¡ç†ã‚‚ã°ã£ã¡ã‚Šã§ã™ã€‚
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card shadow-sm h-100 text-white"
                    style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); color: #555 !important;">
                    <div class="card-body p-4">
                        <div class="feature-icon-wrapper text-white" style="background: rgba(0,0,0,0.1);">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h5 class="fw-bold mb-3 text-dark">ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç®¡ç†</h5>
                        <p class="text-dark opacity-75 mb-0">
                            ã‚ªã‚¤ãƒ«äº¤æ›ã‚„ã‚¿ã‚¤ãƒ¤äº¤æ›ãªã©ã®æ•´å‚™å±¥æ­´ã‚’è¨˜éŒ²ã€‚æ¬¡å›ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚æœŸã‚‚ãŠçŸ¥ã‚‰ã›ã€‚
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card shadow-sm h-100 text-white"
                    style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #444 !important;">
                    <div class="card-body p-4">
                        <div class="feature-icon-wrapper text-white" style="background: rgba(0,0,0,0.1);">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h5 class="fw-bold mb-3 text-dark">ã‚µãƒ¼ã‚­ãƒƒãƒˆèµ°è¡Œãƒ­ã‚°</h5>
                        <p class="text-dark opacity-75 mb-0">
                            ã‚µãƒ¼ã‚­ãƒƒãƒˆã”ã¨ã®èµ°è¡Œãƒ‡ãƒ¼ã‚¿ã‚„ã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’è©³ç´°ã«è¨˜éŒ²ã€‚ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ æ›´æ–°ã‚’ç›®æŒ‡ãã†ã€‚
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card shadow-sm h-100 text-white"
                    style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); color: #555 !important;">
                    <div class="card-body p-4">
                        <div class="feature-icon-wrapper text-white" style="background: rgba(0,0,0,0.1);">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <h5 class="fw-bold mb-3 text-dark">Misskey é€£æº</h5>
                        <p class="text-dark opacity-75 mb-0">
                            è¨˜éŒ²ã—ãŸå†…å®¹ã¯ãƒœã‚¿ãƒ³ä¸€ã¤ã§Misskeyã«ã‚·ã‚§ã‚¢ã€‚ãƒã‚¤ã‚¯ä»²é–“ã¨æ´»å‹•ã‚’å…±æœ‰ã§ãã¾ã™ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# --- How it Works (Timeline) --- #}
    <div class="py-5 bg-light rounded-4 px-4 px-md-5">
        <div class="row align-items-center">
            <div class="col-lg-5 mb-4 mb-lg-0">
                <h2 class="fw-bold mb-4">ä½¿ã„æ–¹ã¯ã¨ã¦ã‚‚ç°¡å˜</h2>
                <p class="text-muted mb-4">
                    ã‚‚ã¨ã·ã£ã·ãƒ¼ã¯ã€ç›´æ„Ÿçš„ãªæ“ä½œã§èª°ã§ã‚‚ç°¡å˜ã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã¾ã™ã€‚<br>
                    ã‚ãªãŸã®æ„›è»Šã¨ã®æ€ã„å‡ºã‚’ã€ä»Šæ—¥ã‹ã‚‰è¨˜éŒ²ã—å§‹ã‚ã¾ã—ã‚‡ã†ã€‚
                </p>
                <a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg rounded-pill px-4 shadow-sm">
                    ã¾ãšã¯ãƒ­ã‚°ã‚¤ãƒ³ <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
            <div class="col-lg-7">
                <div class="step-timeline ms-md-4">
                    <div class="step-item">
                        <div class="step-marker">1</div>
                        <h5 class="fw-bold">Misskeyã§ãƒ­ã‚°ã‚¤ãƒ³</h5>
                        <p class="text-muted small">ãŠæŒã¡ã®Misskeyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦èªè¨¼ã—ã¾ã™ã€‚é¢å€’ãªIDç™»éŒ²ã¯ä¸è¦ã§ã™ã€‚</p>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">2</div>
                        <h5 class="fw-bold">è»Šä¸¡ã‚’ç™»éŒ²</h5>
                        <p class="text-muted small">ã‚ãªãŸã®æ„›è»Šã‚’ç™»éŒ²ã—ã¾ã—ã‚‡ã†ã€‚è¤‡æ•°å°ã®ç®¡ç†ã‚‚å¯èƒ½ã§ã™ã€‚</p>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">3</div>
                        <h5 class="fw-bold">æ´»å‹•ã‚’è¨˜éŒ²</h5>
                        <p class="text-muted small">çµ¦æ²¹ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ãƒ„ãƒ¼ãƒªãƒ³ã‚°ã®è¨˜éŒ²ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚å†™çœŸã‚‚æ·»ä»˜ã§ãã¾ã™ã€‚</p>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">4</div>
                        <h5 class="fw-bold">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèª</h5>
                        <p class="text-muted small">é›†ã¾ã£ãŸãƒ‡ãƒ¼ã‚¿ã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å¯è¦–åŒ–ã€‚æ„›è»Šã®çŠ¶æ…‹ãŒä¸€ç›®ã§ã‚ã‹ã‚Šã¾ã™ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# --- Notices & Footer Links --- #}
    <div class="row justify-content-center mt-5">
        <div class="col-md-8">
            {% if important_notice %}
            <div class="alert alert-warning p-3 mb-4 small shadow-sm" role="alert">
                <h6 class="alert-heading fw-bold"><i class="fas fa-exclamation-triangle me-1"></i> {{
                    important_notice.title }}</h6>
                <hr class="my-2">
                <p class="mb-0">{{ important_notice.content | replace('\n', '<br>') | safe }}</p>
            </div>
            {% endif %}

            {% if announcements %}
            <div class="card mb-4 border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <i class="fas fa-info-circle me-1 text-info"></i> ãŠçŸ¥ã‚‰ã›
                </div>
                <div class="list-group list-group-flush">
                    {% set latest_notice_for_card = announcements | first %}
                    {% if latest_notice_for_card %}
                    <div class="list-group-item border-0">
                        <h6 class="mb-1 fw-bold">{{ latest_notice_for_card.title }}</h6>
                        <p class="mb-1 small text-muted">
                            {{ latest_notice_for_card.content | truncate(100, true, '...') | replace('\n', '<br>') |
                            safe }}
                        </p>
                    </div>
                    {% endif %}
                    <div class="list-group-item border-0 text-center py-2">
                        <button type="button" class="btn btn-link btn-sm text-decoration-none" data-bs-toggle="modal"
                            data-bs-target="#announcementsModal">
                            ã™ã¹ã¦ã®ãŠçŸ¥ã‚‰ã›ã‚’è¦‹ã‚‹
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="text-center my-4">
                <small class="text-muted">
                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€<a href="{{ url_for('main.terms_of_service') }}" target="_blank"
                        rel="noopener noreferrer">åˆ©ç”¨è¦ç´„</a>ãŠã‚ˆã³<a href="{{ url_for('main.privacy_policy') }}"
                        target="_blank" rel="noopener noreferrer">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
                </small>
            </div>

            {% if config.ENV == 'development' %}
            <div class="text-center my-4 p-3 bg-light rounded border border-warning border-opacity-25">
                <p class="small text-muted mb-2 fw-bold">ğŸ›  é–‹ç™ºè€…ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼</p>
                {% if config.LOCAL_DEV_USER_ID %}
                <a href="{{ url_for('dev_auth.local_login') }}" class="btn btn-secondary btn-sm">
                    <i class="fas fa-code me-1"></i>é–‹ç™ºç”¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ­ã‚°ã‚¤ãƒ³
                </a>
                {% else %}
                <button class="btn btn-secondary btn-sm" disabled title=".envã«LOCAL_DEV_USER_IDã‚’è¨­å®šã—ã¦ãã ã•ã„">é–‹ç™ºç”¨ãƒ­ã‚°ã‚¤ãƒ³
                    (IDæœªè¨­å®š)</button>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

{# --- Announcements Modal --- #}
<div class="modal fade" id="announcementsModal" tabindex="-1" aria-labelledby="announcementsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="announcementsModalLabel"><i class="fas fa-info-circle me-2"></i>ãŠçŸ¥ã‚‰ã›ä¸€è¦§</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% for notice in announcements %}
                <div class="mb-3 pb-2 {% if not loop.last %}border-bottom{% endif %}">
                    <h6 class="mb-1 fw-bold">{{ notice.title }}</h6>
                    <p class="mb-0 small text-muted">{{ notice.content | replace('\n', '<br>') | safe }}</p>
                </div>
                {% else %}
                <p>ç¾åœ¨ã€è¡¨ç¤ºã§ãã‚‹ä»–ã®ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                {% endfor %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const loginButton = document.getElementById('login-button');
        if (loginButton) {
            loginButton.addEventListener('click', function (event) {
                event.preventDefault();

                const rememberMeCheckbox = document.getElementById('remember-me');
                const remember = rememberMeCheckbox.checked;

                let loginUrl = this.href;

                if (remember) {
                    if (loginUrl.includes('?')) {
                        loginUrl += '&remember=1';
                    } else {
                        loginUrl += '?remember=1';
                    }
                }

                window.location.href = loginUrl;
            });
        }
    });
</script>
{% endblock %}